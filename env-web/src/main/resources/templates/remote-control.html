<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>设置我的资料</title>
  <meta name="renderer" content="webkit">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=0">
  <link rel="stylesheet"  media="all" th:href="@{/layuiadmin/layui/css/layui.css}">
  <link rel="stylesheet"  media="all" th:href="@{/layuiadmin/style/admin.css}">
  <script type="text/javascript" th:src="@{/js/jquery-3.3.1.min.js}"></script>
  <script type="text/javascript" th:src="@{/js/fast-helper.js}"></script>
  <script  th:src="@{/layuiadmin/layui/layui.js}"></script>
  <script  th:src="@{/layuiadmin/layui/iconfont.js}"></script>
  <style>
    .icon {
      width:60px;
      height: 60px;
      fill: currentColor;
      overflow: hidden;
      padding: 30px 0 20px 0;
    }
  </style>
    <style type="text/css">
      /* define bootstrap 5 columns */
    .col-xs-1-5,
    .col-sm-1-5,
    .col-md-1-5,
    .col-lg-1-5 {
      position: relative;
      min-height: 1px;
      padding-right: 10px;
      padding-left: 10px;
    }

    .col-xs-1-5 {
      width: 20%;
      float: left;
    }
    @media (min-width: 1200px) {
      .col-lg-1-5 {
        width: 20%;
        float: left;
      }
    }
  </style>
</head>
<body>
<style>
  /* 这段样式只是用于演示 */
  #LAY-component-grid-list .demo-list .layui-card{height: 267px;}
</style>
<div class="layui-fluid" id="LAY-component-grid-list">
  <div class="layui-col-md12">
    <div class="layui-card">
      <div class="layui-card-header layui-form">
        <div class="layui-form-item">
          <div class="layui-inline">
            <label class="layui-form-label">站点：</label>
            <div class="layui-input-block">
	              <select name="siteInfo" id="siteInfo" lay-filter="zhandian">
	                <option value="-1" selected="selected">--请选择站点--</option>
	              </select>
              </div>
            </div>
          </div>   
        </div>
      </div>
      <div class="layui-card-body">
        <div class="layui-row layui-col-space10 demo-list">
        
          <div class="layui-col-sm4 layui-col-md3 col-lg-1-5">
            <div class="layui-card" style="border: 1px solid #eeeeee">
              <div style="height: 167px;text-align: center;border-bottom: 1px dashed #CCCCCC">
                <svg class="icon" aria-hidden="true">
                  <use xlink:href="#icon-celiangdian"></use>
                </svg>
                <p>测量</p>
              </div>
              <div style="text-align: center;padding:20px 0 0 0 ;">
                <button class="layui-btn layui-btn-normal" id = "simple-test-button">测量</button>
              </div>
            </div>
          </div>
          
          <div class="layui-col-sm4 layui-col-md3 col-lg-1-5">
            <div class="layui-card" style="border: 1px solid #eeeeee">
              <div style="height: 167px;text-align: center;border-bottom: 1px dashed #CCCCCC">
                <svg class="icon" aria-hidden="true" style="color: #b23cff">
                  <use xlink:href="#icon-yangpinguanli"></use>
                </svg>
                <p>留样</p>
              </div>
              <div style="text-align: center;padding:20px 0 0 0 ;">
                <button class="layui-btn layui-btn-normal">留样</button>
              </div>
            </div>
          </div>
          
          <div class="layui-col-sm4 layui-col-md3 col-lg-1-5">
              <div class="layui-card" style="border: 1px solid #eeeeee">
                <div style="height: 167px;text-align: center;border-bottom: 1px dashed #CCCCCC">
                  <svg class="icon" aria-hidden="true" style="color: #b23cff">
                    <use xlink:href="#icon-qidong"></use>
                  </svg>
                  <p>开机</p>
                </div>
                <div style="text-align: center;padding:20px 0 0 0 ;">
                  <button class="layui-btn layui-btn-normal">开机</button>
                </div>
              </div>
            </div>
          
          <div class="layui-col-sm4 layui-col-md3 col-lg-1-5">
            <div class="layui-card" style="border: 1px solid #eeeeee">
              <div style="height: 167px;text-align: center;border-bottom: 1px dashed #CCCCCC">
                <svg class="icon" aria-hidden="true">
                  <use xlink:href="#icon-tingzhi"></use>
                </svg>
                <p>关机</p>
              </div>
              <div style="text-align: center;padding:20px 0 0 0 ;">
                <button class="layui-btn layui-btn-normal">关机</button>
              </div>
            </div>
          </div>
          
          <div class="layui-col-sm4 layui-col-md3 col-lg-1-5">
            <div class="layui-card" style="border: 1px solid #eeeeee">
              <div style="height: 167px;text-align: center;border-bottom: 1px dashed #CCCCCC">
                <svg class="icon" aria-hidden="true">
                  <use xlink:href="#icon-fuwei"></use>
                </svg>
                <p>重启</p>
              </div>
              <div style="text-align: center;padding:20px 0 0 0 ;">
                <button class="layui-btn layui-btn-normal">重启</button>
              </div>
            </div>
          </div>
          
          <div class="layui-col-sm4 layui-col-md3 col-lg-1-5">
            <div class="layui-card" style="border: 1px solid #eeeeee">
              <div style="height: 167px;text-align: center;border-bottom: 1px dashed #CCCCCC">
                <svg class="icon" aria-hidden="true">
                  <use xlink:href="#icon-qingxi"></use>
                </svg>
                <p>清洗</p>
              </div>
              <div style="text-align: center;padding:20px 0 0 0 ;">
                <button class="layui-btn layui-btn-normal">清洗</button>
              </div>
            </div>
          </div>
      	</div>
      </div>
</div>
</div>


  <script>
  layui.config({
    base: 'layuiadmin/' //静态资源所在路径
  }).extend({
    index: 'lib/index' //主入口模块
  }).use(['index', 'set','form'],function(){
	  var form = layui.form
	  
	  $.post('site/codeNameMap', function(result){
		  	 var select = $("#siteInfo");
			 for(var key in result.data){
				 var option = $('<option></option>').val(key).append(result.data[key]);
				 select.append(option);
			 }
			 setTimeout(function(){
				 layui.form.render("select")
			 },50)
		  });
	  
	  function sendMsg(param) {
	    	var index = layui.layer.load()
		 	var xhr = $.ajax({
		 		url:'deviceSend/send',
		 		type:"POST",
		 		dataType:"JSON",
		 		data:param,
		 		timeout: 30000, 
		 		success : function(result){
		 			layui.layer.close(index); 
					var msg = result.msg;
					if (result.success) {
						alert_yes(msg);
					}else {
						alert_no(msg);
					}
		 		},
		 		complete: function (XMLHttpRequest,status) {
	                if(status == 'timeout') {
	                    xhr.abort();    // 超时后中断请求
	                    alert_no("无响应")
	                }
	            },
		 		error:function(){
		 			layui.layer.close(index); 
		 			layui.layer.msg('系统异常');
		 		}
		 	}); 
	    }
	    
	    // 站点设备下行
	  	function device(type) {
			 // 获取下拉框选中的设备编号
			 var accessCode = $("#siteInfo").val();
			 if (accessCode == -1) {
				alert_no("请先选择站点");
				return false;
			 }
			 var param = {
				 deviceId : accessCode,
				 type : type
			 }
			 // 发送下行消息
			 sendMsg(param);
	  	}
	  	
	  	// button按钮点击事件
		$('button').on('click', function(){
			switch(this.innerText){
				case '测量': layer.confirm('确定进行单次测量吗？',function(index){device('T010')}); break;
				case '关机': layer.confirm('确定进行关机吗？',function(index){device('T005')}); break;
				case '重启': layer.confirm('确定进行重启吗？',function(index){device('T006')}); break;
				case '留样': layer.confirm('确定进行远程留样吗？',function(index){device('T007')}); break;
				case '清洗': layer.confirm('确定进行设备清洗吗？',function(index){device('T011')}); break;
				case '开机': layer.confirm('确定进行开机吗？',function(index){device('T004')}); break;
			}		
		});
  });

    
  </script>
</body>
</html>